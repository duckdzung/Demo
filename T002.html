<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Quản lý Khách hàng</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
</head>

<body>

    <!-- Ô nhập liệu tìm kiếm -->
    <input type="text" id="name" placeholder="Tên">
    <select id="sex">
        <option value="">-- Giới tính --</option>
        <option value="Male">Nam</option>
        <option value="Female">Nữ</option>
    </select>
    <input type="date" id="birthdayFrom">
    <input type="date" id="birthdayTo">
    <button id="searchBtn">Tìm kiếm</button>

    <!-- Bảng khách hàng -->
    <table id="customerTable" class="display">
        <thead>
            <tr>
                <!-- Render danh sách cột từ session -->
                <th th:each="column : ${session.columns}" th:data-column="${column.key}" th:text="${column.label}"></th>
            </tr>
        </thead>
    </table>

    <script>
        $(document).ready(function () {
            let columnDefs = [];

            // Lấy danh sách cột từ thẻ <th>
            $('#customerTable thead th').each(function () {
                columnDefs.push({ data: $(this).attr("data-column") });
            });

            let table = $('#customerTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/customers/search',
                    type: 'GET',
                    data: function (d) {
                        d.name = $('#name').val();
                        d.sex = $('#sex').val();
                        d.birthdayFrom = $('#birthdayFrom').val();
                        d.birthdayTo = $('#birthdayTo').val();

                        // Chuyển order[0][column] thành tên cột dựa trên thẻ <th>
                        let orderColumnIndex = d.order[0].column;
                        d.orderColumn = $('#customerTable thead th').eq(orderColumnIndex).attr("data-column");
                        d.orderDir = d.order[0].dir;
                    }
                },
                columns: columnDefs
            });

            $('#searchBtn').click(function () {
                table.ajax.reload();
            });
        });
    </script>

</body>

</html>